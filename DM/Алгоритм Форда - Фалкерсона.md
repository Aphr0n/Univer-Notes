Нехай задано транспортну мережу $\vec{G} = (V, \vec{H})$ з джерелом $s$ та стоком $t$. У момент виконання умови зупинки алгоритму Форда—Фалкерсона алгоритм повертає **максимальний потік** $\tau_{\text{opt}}.$ Крім того, якщо $X$ — множина досліджених (позначених) вершин, а $\overline{X}$ — множина непозначених вершин, то розріз $\langle X, \overline{X} \rangle$ є **мінімальним**, і виконується $q(\langle X, \overline{X} \rangle) = q^{\text{opt}}.$
# Метод алгоритму (розширення потоку через резервні шляхи)
1. Генеруємо множину вершин, досяжних з джерела $s$ по **резервних напівшляхах**. Для цього використовуємо **позначки вершин**.
2. Кожна вершина, крім стоку $t$, що має позначку, містить інформацію про:
   - знайдений резервний напівшлях до неї з відповідною резервою;
   - останнє ребро, по якому ми в неї потрапили.
3. Для розширення потоку вибираємо будь-яку **позначену, але не досліджену** вершину і проставляємо їй позначку за правилами алгоритму.
4. Якщо вершина $t$ отримує позначку, позначення завершено, і за ним відновлюємо резервний $s$–$t$ шлях.
5. По цьому шляху збільшуємо потік $\tau$ на величину резерви і отримуємо новий потік $\tau'$.
6. Видаляємо всі позначки та повторюємо процес для нового потоку $\tau'$.
7. Якщо при черговому позначенні вершина $t$ не отримала позначку, потік є **максимальним**.
8. Позначені множини:
   - $X_0 = PV$ — досліджені (позначені) вершини;
   - $X_1 = NV$ — недосліджені вершини.  
   Розріз $\langle X_0, X_1 \rangle$ в цей момент є **мінімальним**.
## Розріз графа
Нехай $\varnothing \neq X_0 \subseteq X$ та $X_1 = X \setminus X_0 \neq \varnothing$.  
Множина ребер $\langle X_0, X_1 \rangle$ називається **розрізом графа** $\vec{G}$, якщо:
- ребра починаються в $X_0$ та закінчуються в $X_1$ (і навпаки);
- розріз **відділяє вершини** $s$ та $t$, якщо $s \in X_0$ та $t \in X_1$.
**Ємність розрізу** $\langle X_0, X_1 \rangle$ визначається як сумарна пропускна здатність ребер з $X_0$ у $X_1$:
$q(\langle X_0, X_1 \rangle) = \sum_{(x_i, x_j) \in \langle X_0, X_1 \rangle} q_{ij}.$ Розріз, у якого ємність мінімальна, називається **мінімальним розрізом**.
# Алгоритм
## Вхідні дані
- Транспортна мережа $\vec{G} = (X, A)$, де:
  - $s$ — джерело,
  - $t$ — стік,
  - інші вершини — перехідні.
- Для кожного ребра $a_{ij} = (x_i, x_j) \in A$ задана **пропускна здатність**  $q_{ij} \in \mathbb{R}_0^+.$
- Потік $\tau : A \to \mathbb{R}_0^+$, який задовольняє умови:
1. Для всіх ребер $0 \le \tau_{ij} \le q_{ij}.$
2. **Закон збереження потоку**:
$$
\sum_{x_j \in \Gamma(x_i)} \tau_{ij} - \sum_{x_k \in \Gamma^{-}(x_i)} \tau_{ki} =
\begin{cases}
0, & x_i \neq s \text{ і } x_i \neq t,\\
T(\tau), & x_i = s,\\
-T(\tau), & x_i = t.
\end{cases}
$$
## Вихідні дані
- **Максимальний s–t потік**: $\tau_{\text{opt}}$
- **Величина максимального потоку**: $T(\tau_{\text{opt}})$
- **Мінімальний s–t розріз**: $\langle X_0, X_1 \rangle$
## Позначення
- $\tau_{ij}$ — величина потоку між вершинами $(x_i, x_j)$  
- $T(\tau)$ — загальна величина s–t потоку $\tau$  
- $\Gamma(x_i)$ — всі сусідні вершини $x_j$ вершини $x_i$, такі що $(x_i, x_j) \in A$  
- $\Gamma^{-}(x_i)$ — всі сусідні вершини $x_k$ вершини $x_i$, такі що $(x_k, x_i) \in A$  
- $\langle X_0, X_1 \rangle$ — розріз графа $\vec{G}$  
- $q(\langle X_0, X_1 \rangle)$ — ємність (пропускна здатність) розрізу $\langle X_0, X_1 \rangle$  
- $q_{ij}$ — ємність (пропускна здатність) ребра $a_{ij}$  
- $NV$ — масив непозначених вершин (не мають позначки)  
- $NOV$ — масив позначених, але недосліджених вершин  
- $PV$ — масив досліджених вершин (мають позначку, а всі їхні сусіди також мають позначку)  
- Позначення змін потоку по ребрах:  
  - $x_i \to [x_j^+, \delta]$ — потік $\tau$ можна **збільшити** по ребру $(x_j, x_i)$ на величину $\delta$  
  - $x_i \to [x_j^-, \delta]$ — потік $\tau$ можна **зменшити** по ребру $(x_i, x_j)$ на величину $\delta$
## Кроки алгоритму 
### K0: Ініціалізаційний крок
- Присвоюємо джерелу $s$ позначку: 
	$s \to [s^+, \delta(s) = +\infty], \quad s \in NOV$
- Для всіх інших вершин $x_i \in A, x_i \neq s$:  
	$x_i \in NV$
- Досліджені вершини $PV = \varnothing$ $\rightarrow$ переходимо до **K1**
### K1: Крок позначення вершин
- Вибираємо вершину $x_i \in NOV$ з позначкою $[x_i^\pm, \delta(x_i)]$
- Позначаємо сусідів за правилами:
1. Для всіх $x_j \in \Gamma(x_i) \cap NV$, якщо $\tau_{ij} < q_{ij}$: $x_j \to [x_i^+, \delta(x_j)], \quad \delta(x_j) = \min\{\delta(x_i), q_{ij} - \tau_{ij}\}, \quad x_j \in NOV$
2. Для всіх $x_j \in \Gamma^{-}(x_i) \cap NV$, якщо $\tau_{ij} > 0$: $x_j \to [x_i^-, \delta(x_j)], \quad \delta(x_j) = \min\{\delta(x_i), \tau_{ij}\}, \quad x_j \in NOV$

- Переміщаємо вершину $x_i \in PV$ $\rightarrow$ переходимо до **K2**
### K2: Тестовий крок
1. Якщо $NOV \neq \varnothing$ і $t \in NV$, $\rightarrow$ **K1**  
2. Якщо $NOV = \varnothing$ і $t \in NV$, $\rightarrow$ **K3**  
3. Якщо $t \in PV$, $\rightarrow$ **K4**
### K3: Вихідний крок
- $X_0 = PV$, $X_1 = NV$  
- Розріз $\langle X_0, X_1 \rangle$ — **мінімальний s–t розріз мережі $\vec{G}$**  $\rightarrow$ **КІНЕЦЬ**
### K4: Початок зворотного розширення потоку
- Присвоюємо $z := t$  $\rightarrow$ переходимо до **K5**
> **Примітка:** на цьому кроці існує резервний $s$–$t$ напівшлях, який ми повинні ідентифікувати з кінцем у $t$.
### K5: Розширення потоку по резервному $s$–$t$ напівшляху
1. Якщо $z \to [x^+, \delta(z)]$, оновлюємо потік по ребру $(x, z)$:
	$\tau(x, z) = \tau(x, z) + \delta(t)$
2. Якщо $z \to [x^-, \delta(z)]$, оновлюємо потік по ребру $(z, x)$:
	$\tau(z, x) = \tau(z, x) - \delta(t)$ $\rightarrow$ переходимо до **K6**
### K6: Тест завершення розширення потоку
1. Якщо $z \neq s$, присвоюємо $z := x$ (попередній вузол) і повертаємось на **K5**  
2. Якщо $z = s$, видаляємо всі позначки та повертаємось на **K0**, починаючи нове присвоєння позначок з оновленим потоком з **K5**
### Примітка
- Алгоритм можна почати з будь-якого початкового потоку $\tau$.  
- Найчастіше використовують **нульовий потік** $T(\tau) = 0$
